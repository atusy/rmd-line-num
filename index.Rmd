---
title: Line number on code blocks with Rmarkdown
author: Atusy
output: 
  # works
  # not works
  html_notebook: 
    highlight: pygments
    css: html-notebook.css
  html_document: 
    highlight: pygments
    toc: true
    toc_float: true
    number_sections: true
    self_contained: false
  pagedown::html_paged: 
    highlight: pygments
    clean_highlight_tags: false
  pdf_document: default
  bookdown::html_document2:
    highlight: tango
    clean_highlight_tags: false
  word_document: default
---

**Before reading:**

- This document introduces how to add line numbers on code blocks 
  when knitting HTML and PDF.
- For quick start, go "[Autonumbering]".
- A source and output examples in variety of formats are available
  on GitHub [`atusy/rmd-line-num`](https://github.com/atusy/rmd-line-num).
- Questions and comments are welcome
  on [GitHub Issues](https://github.com/atusy/rmd-line-num/issues) or 
  on Twitter ([\@Atsushi776](https://twitter.com/Atsushi776))

# Number Pandoc's fenced code

Pandoc supports line numbers on fenced codes 
  by giving a class attribute `numberLines` [^numberLines].
For example,

[^numberLines]: 
  Class attributes require leading `.` for values (e.g., `.numberLines`).
  See Pandoc's manual for detail
  (<https://www.pandoc.org/MANUAL.html#extension-fenced_code_attributes>).

````{.numberLines}
```{.r .numberLines}
x <- rnorm(10)
mean(x)
```
````

becomes

```{.r .numberLines}
x <- rnorm(10)
mean(x)
```

`pdf_document` requires nothing more.
On the other hand, `html_document` also requires a YAML front matter 
  with a `highlight` argument being specified[^pygments]^,^ [^highlight-styles].

[^pygments]: 
  "Chunk numberLines hook" on Rpubs figured out requirement of `pygment`
  (<https://rpubs.com/Thell/numberLines>).

[^highlight-styles]: 
  See `help(rmarkdown::html_document)` for available highlighting styles.

```{.yaml .numberLines}
---
title: Line numbers with Rmarkdown documents
output: 
  pdf_document: default
  html_document:
    highlight: pygments
---
```

`bookdown::html_document2` and `pagedown::html_paged` 
  further require `clean_highlight_tags: false` in YAML front matter.


```{.yaml .numberLines}
---
title: Line numbers with Rmarkdown documents
output: 
  bookdown::html_document2:
    highlight: pygments
    clean_highlight_tags: false
  pagedown::html_paged:
    highlight: pygments
    clean_highlight_tags: false
---
```

## `html_notebook` requires modified CSS

<https://github.com/atusy/rmd-line-num/issues/1>

## `blogdown::html_page` requires `highlight.js`

Although Hugo natively supports line numbers on code blocks,
this requires complex tricks for Rmarkdown users.
Thus, I recommend `highlight.js`

# Number Rmarkdown's chunks and outputs

The above success infers a success in chunks of Rmarkdown.

## Numbering chunks

For code chunks in Rmarkdown documents,
  specify `class.source = "numberLines"` as a chunk option to
  assign the `numberLines` class[^yihui]. 

[^yihui]: 
  See "Tex Results" section of "Chunk options and package options" by Yi Hui 
  (<https://yihui.name/knitr/options/#text-results>)

Again, you need `highlight: pygments` for `html_document`.

Thus,

````{.numberLines}
---
title: Line numbers with Rmarkdown documents
output: 
  html_document:
    highlight: pygments
---

```{`r "r"`, class.source = "numberLines"}
x <- seq(10)
mean(x)
```
````

becomes

```{r, class.source = "numberLines"}
x <- seq(10)
mean(x)
```

Great again!!

## Numbering outputs

Add line numbers on outputs by specifying `class.output = "numberLines"` as a chunk option.
Note that the result has gray background which is difficult to be distinguished from inputs.

```{r, class.source = "numberLines", class.output = "numberLines"}
x <- seq(10)
mean(x)
```

If output format is HTML, use CSS.
I do not support LaTeX which kills me.

Let's see how to style output on HTML and CSS.

Before adding `class.output = "numberLines"`, an output in HTML is

```{.html .numberLines}
<pre><code>## [1] 5.5</code></pre>
```

After adding the attribute, the output in becomes

```{.html .numberLines}
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource numberLines"><code class="sourceCode"><a class="sourceLine" id="cb7-1" title="1">## [1] 5.5</a></code></pre></div>
```

When `chunkout` class is further added, the output in html becomes

```{.html .numberLines}
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource numberLines chunkout"><code class="sourceCode"><a class="sourceLine" id="cb10-1" title="1">## [1] 5.5</a></code></pre></div>
```

You can see `chunkout` class is added to `pre` tag.

So, add a following CSS code:

```{css, class.source = "numberLines"}
div.sourceCode pre.chunkout {
  background: white;
}
```

and you'll be happy, right?

```{r, class.source = "numberLines", class.output = c("numberLines", "chunkout")}
x <- seq(10)
mean(x)
```

# Autonumbering

- Edit after `<!-- Start your body -->` of the following template.
- Disable line numbers temporarily by specifying
  `class.source = NULL` and `class.output = NULL` for chunk options.

## A template

````{.numberLines}
---
output:
  html_document:
    highlight: pygments
  pdf_document: default
---

```{`r "r"` setup, include = FALSE}
knitr::opts_chunk$set(
  class.source = "numberLines", 
  class.output = c("numberLines", "chunkout") 
)

# Add some arbitrary setup codes
```


```{`r "css"`, echo = FALSE}
div.sourceCode pre.chunkout {
  background: white;
}
```

<!-- Start your body -->

**Numbered**

```{`r "r"`}
x <- seq(10)
mean(x)
```

**Unnumbered**

```{`r "r"`, class.source = NULL, class.output = NULL}
x <- seq(10)
mean(x)
```

````

Pandoc also supports autonumbering for `indended code` [^indended-code].
However, I do not recommend this because of poorly supported attributes.

```{.yaml .numberLines}
---
output:
  html_document:
    highlight: pygments
    pandoc_args:
      - --indented-code-classes
      - lineNumbers
---

    x <- seq(10)
    mean(x)

```

## Output from the template

**Numbered**

```{r, class.source = "numberLines", class.output = c("numberLines", "chunkout")}
x <- seq(10)
mean(x)
```

**Unnumbered**

```{r, class.source = NULL, class.output = NULL}
x <- seq(10)
mean(x)
```

# Enjoy !