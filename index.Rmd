---
title: Number lines in code blocks with Rmarkdown
author: Atusy
output: 
  html_document: 
    highlight: pygment
    toc: true
    number_sections: true
  html_notebook: 
    highlight: pygment
  pdf_document: default
  word_document: default
---

**Go [`atusy/rmd-line-num`](https://github.com/atusy/rmd-line-num) on GitHub to see source files and output examples in variety of formats.**

# In pandoc style fenced code

Pandoc has an official support to number lines on fenced code by giving a class attribute `numberLines` 
(<https://www.pandoc.org/MANUAL.html#extension-fenced_code_attributes>).

Note that class attributes require `.` before the class name.

````
```{.r .numberLines}
x <- rnorm(10)
mean(x)
```
````

becomes

```{.r .numberLines}
x <- rnorm(10)
mean(x)
```

Great!

# In Rmarkdown's chunk

The above success infers a success in chunks of Rmarkdown.

For code chunks of Rmarkdown documents,
`numberLines` class can be given by assigning `class.source = "numberLines"` as a chunk option. [^yihui]

[^yihui]: See "Tex Results" section of "Chunk options and package options" by Yi Hui (<https://yihui.name/knitr/options/#text-results>)

This is enough for `rmarkdown::pdf_document`.
On the other hand, `rmarkdown::html_document` requires `highlyght: pygment` in a YAML front matter[^pygment].

[^pygment]: "Chunk numberLines hook]" on Rpubs figured out requirement of `pygment` (<https://rpubs.com/Thell/numberLines>).

Thus,

````
---
title: Line numbers with Rmarkdown documents
output: 
  html_document:
    highlight: pygment
---

```{`r "r"`, class.source = "numberLines"}
x <- seq(10)
mean(x)
```
````

becomes

```{r, class.source = "numberLines"}
x <- seq(10)
mean(x)
```

Great again!!


Unfortunately, line numbering does not work on `rmarkdown::word_document`.

It does not work properly on `rmarkdown::html_notebook` and `blogdown::html_page` as well.
I guess some tricks required in CSS or JS.

## Numbering outputs

You may also want to number lines on outputs by `class.output = "numberLines"`.
However, this changes background colors to gray.

```{r, class.source = "numberLines", class.output = "numberLines", echo = FALSE}
x <- seq(10)
mean(x)
```

If output format is html, css will help.

Before adding `class.output = "numberLines"`, an output in html is

```{.html}
<pre><code>## [1] 5.5</code></pre>
```

After adding it, the output in html becomes

```{.html}
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource numberLines"><code class="sourceCode"><a class="sourceLine" id="cb7-1" title="1">## [1] 5.5</a></code></pre></div>
```

When `chunkout` class is further added, the output in html becomes

```{.html}
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource numberLines chunkout"><code class="sourceCode"><a class="sourceLine" id="cb10-1" title="1">## [1] 5.5</a></code></pre></div>
```

You can see `chunkout` class is added to `pre` tag.

So, lets modify css with

```{css}
div.sourceCode pre.chunkout {
  background: white;
}
```

and you'll be happy, right?

```{r, class.source = "numberLines", class.output = c("numberLines", "chunkout"), echo = FALSE}
x <- seq(10)
mean(x)
```

Sorry I do not support pdf because $LaTeX$ kills me.

## Numbering in default

Super easy.

Run following at just after a YAML front matter.

````{.r}
```{`r "r"` setup}
knitr::opts_chunk$set(
  class.source = "numberLines",
  class.output = c("numberLines", "chunkout")
)
```

```{`r "css"`}
div.sourceCode pre.chunkout {
  background: white;
}
```
````

Note that this does not affect pandoc style fenced code.
According to pandoc's document, setting up a following YAML front matter should work, but doesn't.

```{.yaml}
output: 
  html_document: 
    highlight: pygment
      panoc_args:
        - --indented-code-classes
        - numberLines
```



# Enjoy !